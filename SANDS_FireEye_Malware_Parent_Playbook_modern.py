"""
This is the parent playbook that will call other playbooks.
"""


import phantom.rules as phantom
import json
from datetime import datetime, timedelta


@phantom.playbook_block()
def on_start(container):
    phantom.debug('on_start() called')

    # call 'db_is_container_previously_investigated' block
    db_is_container_previously_investigated(container=container)

    return

@phantom.playbook_block()
def api_comment_investigation_finished_tag(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("api_comment_investigation_finished_tag() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    phantom.comment(container=container, comment="investigation_finished in the container. Hence this container will not be run again.")

    return


@phantom.playbook_block()
def api_add_container_tag_pending_updaet_not(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("api_add_container_tag_pending_updaet_not() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    phantom.add_tags(container=container, tags="pending_update_notable")

    playbook_mbs_sands_common_sync_notes_snow_notable_1(container=container)

    return


@phantom.playbook_block()
def playbook_sands_fireeye_malware_ingest2_find_os_type_playbook_modern_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_sands_fireeye_malware_ingest2_find_os_type_playbook_modern_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "mbs/SANDS_FireEye_Malware_Ingest2_Find_OS_Type_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("mbs/SANDS_FireEye_Malware_Ingest2_Find_OS_Type_Playbook_modern", container=container, name="playbook_sands_fireeye_malware_ingest2_find_os_type_playbook_modern_1", callback=playbook_sands_fireeye_malware_ingest3_playbook_modern_1)

    return


@phantom.playbook_block()
def playbook_sands_fireeye_malware_ingest_common_mark_internal_playbook_modern_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_sands_fireeye_malware_ingest_common_mark_internal_playbook_modern_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "mbs/SANDS_FireEye_Malware_Ingest_Common_Mark_Internal_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("mbs/SANDS_FireEye_Malware_Ingest_Common_Mark_Internal_Playbook_modern", container=container, name="playbook_sands_fireeye_malware_ingest_common_mark_internal_playbook_modern_1", callback=playbook_sands_fireeye_malware_document_sir_playbook_modern_1)

    return


@phantom.playbook_block()
def playbook_sands_fireeye_malware_document_sir_playbook_modern_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_sands_fireeye_malware_document_sir_playbook_modern_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "mbs/SANDS_FireEye_Malware_Document_SIR_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("mbs/SANDS_FireEye_Malware_Document_SIR_Playbook_modern", container=container, name="playbook_sands_fireeye_malware_document_sir_playbook_modern_1", callback=playbook_sands_fireeye_malware_document_sir_playbook_modern_1_callback)

    return


@phantom.playbook_block()
def playbook_sands_fireeye_malware_document_sir_playbook_modern_1_callback(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_sands_fireeye_malware_document_sir_playbook_modern_1_callback() called")

    
    playbook_mbs_sands_fireeye_malware_domain_investigate_playbook_1(action=action, success=success, container=container, results=results, handle=handle, filtered_artifacts=filtered_artifacts, filtered_results=filtered_results)
    join_playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1(action=action, success=success, container=container, results=results, handle=handle, filtered_artifacts=filtered_artifacts, filtered_results=filtered_results)
    join_playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1(action=action, success=success, container=container, results=results, handle=handle, filtered_artifacts=filtered_artifacts, filtered_results=filtered_results)
    playbook_mbs_sands_fireeye_malware_url_investigate_playbook_1(action=action, success=success, container=container, results=results, handle=handle, filtered_artifacts=filtered_artifacts, filtered_results=filtered_results)


    return


@phantom.playbook_block()
def playbook_sands_fireeye_malware_ingest3_playbook_modern_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_sands_fireeye_malware_ingest3_playbook_modern_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "mbs/SANDS_FireEye_Malware_Ingest3_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("mbs/SANDS_FireEye_Malware_Ingest3_Playbook_modern", container=container, name="playbook_sands_fireeye_malware_ingest3_playbook_modern_1", callback=playbook_sands_fireeye_malware_ingest_common_mark_internal_playbook_modern_1)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_url_investigate_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_url_investigate_playbook_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_URL_Investigate_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_URL_Investigate_Playbook_modern", container=container, name="playbook_mbs_sands_fireeye_malware_url_investigate_playbook_1", callback=playbook_mbs_sands_fireeye_malware_url_investigate_playbook_1_callback)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_url_investigate_playbook_1_callback(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_url_investigate_playbook_1_callback() called")

    
    join_playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1(action=action, success=success, container=container, results=results, handle=handle, filtered_artifacts=filtered_artifacts, filtered_results=filtered_results)
    playbook_mbs_sands_fireeye_malware_investigate_other_access_url_playbook_1(action=action, success=success, container=container, results=results, handle=handle, filtered_artifacts=filtered_artifacts, filtered_results=filtered_results)


    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_domain_investigate_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_domain_investigate_playbook_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_Domain_Investigate_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_Domain_Investigate_Playbook_modern", container=container, name="playbook_mbs_sands_fireeye_malware_domain_investigate_playbook_1", callback=playbook_mbs_sands_fireeye_malware_domain_investigate_playbook_1_callback)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_domain_investigate_playbook_1_callback(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_domain_investigate_playbook_1_callback() called")

    
    join_playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1(action=action, success=success, container=container, results=results, handle=handle, filtered_artifacts=filtered_artifacts, filtered_results=filtered_results)
    playbook_mbs_sands_fireeye_malware_add_host_info_note_playbook_1(action=action, success=success, container=container, results=results, handle=handle, filtered_artifacts=filtered_artifacts, filtered_results=filtered_results)


    return


@phantom.playbook_block()
def join_playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("join_playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1() called")

    if phantom.completed(playbook_names=["playbook_sands_fireeye_malware_document_sir_playbook_modern_1", "playbook_mbs_sands_fireeye_malware_domain_investigate_playbook_1"]):
        # call connected block "playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1"
        playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1(container=container, handle=handle)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_IP_Investigate_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_IP_Investigate_Playbook_modern", container=container, name="playbook_mbs_sands_fireeye_malware_ip_investigate_playbook_1", callback=playbook_mbs_sands_fireeye_malware_investigate_other_comms_ip_playbook_1)

    return


@phantom.playbook_block()
def playbook_mbs_sands_common_sync_notes_snow_notable_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_common_sync_notes_snow_notable_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_Common_Sync_Notes_SNOW_Notable_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_Common_Sync_Notes_SNOW_Notable_modern", container=container, name="playbook_mbs_sands_common_sync_notes_snow_notable_1", callback=playbook_mbs_sands_common_sync_notes_snow_notable_1_callback)

    return


@phantom.playbook_block()
def playbook_mbs_sands_common_sync_notes_snow_notable_1_callback(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_common_sync_notes_snow_notable_1_callback() called")

    
    # Downstream End block cannot be called directly, since execution will call on_finish automatically.
    # Using placeholder callback function so child playbook is run synchronously.


    return


@phantom.playbook_block()
def playbook_sands_fireeye_malware_ingest1_data_playbook_modern_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_sands_fireeye_malware_ingest1_data_playbook_modern_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "mbs/SANDS_FireEye_Malware_Ingest1_Data_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("mbs/SANDS_FireEye_Malware_Ingest1_Data_Playbook_modern", container=container, name="playbook_sands_fireeye_malware_ingest1_data_playbook_modern_1", callback=playbook_sands_fireeye_malware_ingest2_find_os_type_playbook_modern_1)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_investigate_common_list_malicious_iocs_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_investigate_common_list_malicious_iocs_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_Investigate_Common_List_Malicious_IOCs_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_Investigate_Common_List_Malicious_IOCs_modern", container=container, name="playbook_mbs_sands_fireeye_malware_investigate_common_list_malicious_iocs_1", callback=playbook_mbs_sands_fireeye_malware_av_scan_playbook_1)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_investigate_other_access_url_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_investigate_other_access_url_playbook_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_Investigate_Other_Access_URL_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_Investigate_Other_Access_URL_Playbook_modern", container=container, name="playbook_mbs_sands_fireeye_malware_investigate_other_access_url_playbook_1", callback=join_playbook_mbs_sands_common_investigate_not_found_iocs_1)

    return


@phantom.playbook_block()
def join_playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("join_playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1() called")

    if phantom.completed(playbook_names=["playbook_sands_fireeye_malware_document_sir_playbook_modern_1", "playbook_mbs_sands_fireeye_malware_url_investigate_playbook_1"]):
        # call connected block "playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1"
        playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1(container=container, handle=handle)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_FileHash_Investigate_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_FileHash_Investigate_Playbook_modern", container=container, name="playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1", callback=join_playbook_mbs_sands_common_investigate_not_found_iocs_1)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_investigate_other_comms_ip_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_investigate_other_comms_ip_playbook_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_Investigate_Other_Comms_IP_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_Investigate_Other_Comms_IP_Playbook_modern", container=container, name="playbook_mbs_sands_fireeye_malware_investigate_other_comms_ip_playbook_1", callback=join_playbook_mbs_sands_common_investigate_not_found_iocs_1)

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_add_host_info_note_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_add_host_info_note_playbook_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_Add_Host_Info_Note_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_Add_Host_Info_Note_Playbook_modern", container=container, name="playbook_mbs_sands_fireeye_malware_add_host_info_note_playbook_1", callback=join_playbook_mbs_sands_common_investigate_not_found_iocs_1)

    return


@phantom.playbook_block()
def join_playbook_mbs_sands_common_investigate_not_found_iocs_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("join_playbook_mbs_sands_common_investigate_not_found_iocs_1() called")

    if phantom.completed(playbook_names=["playbook_mbs_sands_fireeye_malware_investigate_other_access_url_playbook_1", "playbook_mbs_sands_fireeye_malware_filehash_investigate_playbook_1", "playbook_mbs_sands_fireeye_malware_investigate_other_comms_ip_playbook_1", "playbook_mbs_sands_fireeye_malware_add_host_info_note_playbook_1"]):
        # call connected block "playbook_mbs_sands_common_investigate_not_found_iocs_1"
        playbook_mbs_sands_common_investigate_not_found_iocs_1(container=container, handle=handle)

    return


@phantom.playbook_block()
def playbook_mbs_sands_common_investigate_not_found_iocs_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_common_investigate_not_found_iocs_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_Common_Investigate_Not_Found_IOCs_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_Common_Investigate_Not_Found_IOCs_modern", container=container, name="playbook_mbs_sands_common_investigate_not_found_iocs_1", callback=playbook_mbs_sands_fireeye_malware_investigate_common_list_malicious_iocs_1)

    return


@phantom.playbook_block()
def db_is_container_previously_investigated(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("db_is_container_previously_investigated() called")

    tags_value = container.get("tags", None)

    # check for 'if' condition 1
    found_match_1 = phantom.decision(
        container=container,
        logical_operator="or",
        conditions=[
            ["investigation_finished", "not in", tags_value],
            ["testing", "in", tags_value]
        ],
        scope="all",
        case_sensitive=True,
        delimiter=None)

    # call connected blocks if condition 1 matched
    if found_match_1:
        playbook_sands_fireeye_malware_ingest1_data_playbook_modern_1(action=action, success=success, container=container, results=results, handle=handle)
        return

    # check for 'else' condition 2
    api_comment_investigation_finished_tag(action=action, success=success, container=container, results=results, handle=handle)

    return


@phantom.playbook_block()
def api_add_tag_investigation_finished(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("api_add_tag_investigation_finished() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    phantom.add_tags(container=container, tags="investigation_finished")

    api_add_container_tag_pending_updaet_not(container=container)

    return


@phantom.playbook_block()
def api_promote_to_case_non_malicious(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("api_promote_to_case_non_malicious() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    phantom.promote(container=container, template="Reported Suspicious Email Handling")

    return


@phantom.playbook_block()
def api_set_owner_malicious(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("api_set_owner_malicious() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    phantom.set_owner(container=container, user_type="role", user_value="Cyber Threat Analyst")

    return


@phantom.playbook_block()
def api_promote_to_case_malicious(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("api_promote_to_case_malicious() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    phantom.promote(container=container, template="Reported Suspicious Email Handling")
    phantom.add_note(container=container, content="", note_format="markdown", title="")

    return


@phantom.playbook_block()
def playbook_mbs_sands_fireeye_malware_av_scan_playbook_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("playbook_mbs_sands_fireeye_malware_av_scan_playbook_1() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    # call playbook "local/SANDS_FireEye_Malware_AV_Scan_Playbook_modern", returns the playbook_run_id
    playbook_run_id = phantom.playbook("local/SANDS_FireEye_Malware_AV_Scan_Playbook_modern", container=container)

    db_is_email_malicious(container=container)
    api_add_tag_investigation_finished(container=container)

    return


@phantom.playbook_block()
def db_is_email_malicious(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("db_is_email_malicious() called")

    # check for 'if' condition 1
    found_match_1 = phantom.decision(
        container=container,
        conditions=[
            ["malicious", "in", "artifact:*.tags"]
        ],
        scope="all",
        case_sensitive=True,
        delimiter=None)

    # call connected blocks if condition 1 matched
    if found_match_1:
        api_promote_to_case_malicious(action=action, success=success, container=container, results=results, handle=handle)
        return

    # check for 'else' condition 2
    api_container_tag_non_malicious(action=action, success=success, container=container, results=results, handle=handle)

    return


@phantom.playbook_block()
def api_container_tag_non_malicious(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("api_container_tag_non_malicious() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    phantom.add_tags(container=container, tags="non_malicious")

    api_promote_to_case_non_malicious(container=container)

    return


@phantom.playbook_block()
def api_set_owner_non_malicious(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, **kwargs):
    phantom.debug("api_set_owner_non_malicious() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    phantom.set_owner(container=container, user_type="role", user_value="Cyber Threat Analyst")

    return


@phantom.playbook_block()
def on_finish(container, summary):
    phantom.debug("on_finish() called")

    ################################################################################
    ## Custom Code Start
    ################################################################################

    # Write your custom code here...

    ################################################################################
    ## Custom Code End
    ################################################################################

    return